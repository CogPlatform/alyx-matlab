% Script to scrape Zserver and add all subjects to db

%% establish db connection
uname = 'kenneth';
passwd = '';

baseURL = 'http://alyx.cortexlab.net/';
options = weboptions;

auth = webread([baseURL 'auth-token/'], 'username', uname, 'password', passwd, options);
authOptions = weboptions('KeyName', 'Authorization', 'KeyValue', ['Token ' auth.token]);
options = weboptions('MediaType','application/json', 'KeyName', 'Authorization', 'KeyValue', ['Token ' auth.token]);


%% determine subjects
expInfoD = dir('Z:\expInfo\*');
subjList = {expInfoD.name};
subjList = subjList([expInfoD.isdir]);
subjList = subjList(3:end); %excl . and ..

%% add them all
for s = 1:length(subjList)
    fprintf(1, 'writing %s\n', subjList{s});
    subjectInfo = struct('nickname', subjList{s});
    newSubject = webwrite([baseURL 'subjects/'], options, subjectInfo);
end
